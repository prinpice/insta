{% extends 'base.html' %}

{% block body %}
<div class="container">
  {% if people.profile.image %}
    <img class="rounded-circle rounded-sm" src="{{ people.profile.image.url }}">
  {% else %}
    <img class="rounded-circle" src="data:image/jpeg;base64,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">
  {% endif %}
  <h1>{{ people.username }} 
  <!-- 만약 현재 접속한 유저가 해당 페이지의 유저를이미 팔로우 한 경우, -->
  {% if user != people %}
    {% if people in user.followings.all %}
      <a class="btn btn-outline-primary" href="{% url 'accounts:follow' people.id %}">언팔로우</a>
    {% else %}
      <a class="btn btn-primary" href="{% url 'accounts:follow' people.id %}">팔로우</a>
    {% endif %}
  {% endif %}
  </h1>
  <div id="app">
    <!-- vue js로 동작하는 버튼 -->
    <button v-show="loading" @click="follow({{ people.id }})" :class="{'btn': true, 'btn-primary': !followed, 'btn-dark': followed }">Vue 팔로우</button>
    <p>[[ test ]]</p>
    <p>팔로우 여부 : [[ followed ]]</p>
  </div>
  
  <p><strong>{{ people.profile.nickname }}</strong></p>
  <p>{{ people.profile.description }}</p>
  <p>{{people.last_name}}{{people.first_name}}</p>
  <!--templates에서는 request.user를 user라고 작성해도 된다.-->
  <!--people을 print하면 string이 나오기 때문에 people.username 안쓰고 그대로 써줘도 된다.-->
  {% if user == people %}
  <a class="btn btn-success" href="{% url 'accounts:password' %}">비밀번호변경</a>
  
  <a class="btn btn-success" href="{% url 'accounts:update' %}">회원정보수정</a>
  <a class="btn btn-danger" href="{% url 'accounts:delete' %}">회원정보탈퇴</a>
  {% endif %}
  <div class="row">
    {% for post in people.post_set.all %}
    <div class="col-4">
      <div class="card">
        <img src="{{ post.image.url }}" class="img-fluid">
        <div class="card-body">
          <p class="card-text">{{ post.content }}</p>
        </div>
        <div class="card-body">
          <a href="{% url 'posts:like' post.id %}">
            <!-- 해당 유저가 like를 했으면, -->
            {% if user in post.like_users.all %}
            <!-- user에 request.user 써도 됨-->
            <i class="fas fa-heart"></i>
            <!-- 아니면, -->
            {% else %}
            <i class="far fa-heart"></i>
            {% endif %}
          </a>
          <p class="card-text">
            {{ post.like_users.count }}명이 좋아합니다.
          </p>
        </div>
        <!-- 해당 글에 작성된 댓글을 모두 출력 -->
        <div class="card-body">
          {% for comment in post.comment_set.all %}
            <div class="card-text">
              <strong>{{ comment.user.username }}</strong> {{ comment.content }}
              {% if comment.user == request.user %}
                <a href="{% url 'posts:comment_delete' comment.id %}" class="btn btn-danger">삭제</a>
              {% endif %}
            </div>
            {% empty %}
            <div>댓글이 없습니다.</div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<script>
  const app = new Vue({
    delimiters: ['[[',']]'], // 구분자 : 기존 구분자가 django template과 겹쳐서 django가 변수로 인식하여 출력하지 않음
    el: '#app',
    data: {
      test: '뷰 잘 동작하니?',
      followed: '', // true여도 시작할때 빈 string이기 때문에 초기 값이 false이다.
      loading: false,
    },
    methods: {
      follow: function(person_id) {
        axios.get(`/accounts/${person_id}/vuefollow/`)
        .then((res)=>{
          // console.log(res.data)
          return res.data
        })
        .then((data)=>{
          this.followed = data.followed
        })
        console.log("팔로우 했다리")
      },
      checkfollow: function(person_id){
        axios.get(`/accounts/${person_id}/checkfollow/`)
        .then((res)=>{
          return res.data
        })
        .then((data)=>{
          this.followed = data.followed
          this.loading = true
        })
      },
    },
    beforeMount: function() {//vue의 property
        //vue가 생성되기전에 실행되는 동작들
        this.checkfollow({{ people.id }}) // dtl은 block안의 모든 곳에서 적용이 된다.
      }
  })
</script>
{% endblock %}